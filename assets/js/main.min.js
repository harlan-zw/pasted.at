function load(){handleResize();$(window).on("resize",handleResize);$(window).on("keydown",handleKeyDown);$(window).on("paste",pasteInterpreter);$(window).on("imagePaste",imagePaste);$(window).on("textPaste",textPaste);$("a").hover(function(){$(this).children("i").css("color","black");$(this).children("i").css("font-size","1.3em")},function(){$(this).children("i").css("color","rgb(166, 226, 46)");$(this).children("i").css("font-size","1em")});$(".content_container").css("display","none");$(".content_container").fadeIn(1e3);$("html").on("dragenter",function(e){if(getTabInUse()=="both"){showDrag=true;lightsOff()}});$("html, #editor").bind("dragover",function(e){showDrag=true;e.preventDefault();if($(this).attr("id")!=="editor"){if(hadEditor){hadEditor=false;clearTimeout(det);det=setTimeout(function(){if(!hadEditor){e.originalEvent.dataTransfer.effectAllowed="none";e.originalEvent.dataTransfer.dropEffect="none"}},200)}else{e.originalEvent.dataTransfer.effectAllowed="none";e.originalEvent.dataTransfer.dropEffect="none"}}else{hadEditor=true;e.originalEvent.dataTransfer.effectAllowed="copy";e.originalEvent.dataTransfer.dropEffect="copy"}});$("#editor").bind("drop",function(e){e.preventDefault();switchToTextEditor();var t=e.originalEvent.dataTransfer.files;var n=t[0];var r=ace.require("ace/ext/modelist");var i=r.getModeForPath(n.name);if(i!=false)editor.getSession().setMode(i.mode);else editor.getSession().setMode("ace/mode/text");var s=new FileReader;s.onload=function(e){var t=e.target.result;editor.getSession().setValue(t)};s.readAsText(n);$("#paste_name").val(n.name);$("#mode").val(i.name);$("#mode").trigger("chosen:updated");lightsOn()});$("html").on("dragleave",function(e){showDrag=false;clearTimeout(timeout);timeout=setTimeout(function(){if(!showDrag){lightsOn()}},200)});$("#mode").change(modeChange);$("#expiration").change(expirationChange);$("#text_form").submit(handleTextFormSubmit);$("#register_form").submit(handleRegisterForm);setAccountNav();$(".fa-times-circle").click(function(){$(this).parent("div").addClass("hidden")});$(".login-exit").click(function(){lightsOn();$(this).parent("div").addClass("hidden")});$(".table_paste_delete").click(function(){var e=$(this).parent().parent().children("td:first-child").text();$.ajax({type:"POST",url:relPath+"p/",data:{paste_id:e,type:"DELETE"},success:function(e){location.reload(true)}})});$("#file_form").submit(function(e){e.preventDefault();Dropzone.forElement(".dropzone").processQueue();return false});enquire.register("all and (max-width: 470px)",handleMobileChanges,true);enquire.register("all and (max-width: 768px)",handleTightWidth,true);$(".account-dropdown li").hover(function(){$(this).css("background-color","#a6e22e")},function(){$(this).css("background-color","white")})}function handleMobileChanges(){$(".header-account-container").hide()}function handleTightWidth(){if(getTabInUse()=="text"||getTabInUse()=="file"){$(".content_container").css("height","97%")}}function setAccountNav(){$(".header-account-container").hover(function(){$(".account-dropdown:not(.side-menu)").fadeIn(100)},function(){$(".account-dropdown:not(.side-menu)").fadeOut(100)});$(".side-menu").parent().hover(function(){$(".side-menu").parent().children("i").css("opacity","0.7");$(".side-menu").fadeIn(100)},function(){$(".side-menu").parent().children("i").css("opacity","1");$(".side-menu").fadeOut(100)});$("#login-link").click(function(){lightsOff(false);$("#login-div").removeClass("hidden")})}function handleRegisterForm(e){e.preventDefault();e.stopPropagation();if(dataSent){return false}if(!validEmail($("#register_email").val())){$("#register_form div:first-child").removeClass("hidden");$("#register_form div:first-child span").text("Invalid email address!");return false}if($("#register_pass").val().length<6){$("#register_form div:first-child").removeClass("hidden");$("#register_form div:first-child span").text("Password must be 6 characters long.");return false}if($("#register_pass").val()!=$("#register_conf_pass").val()){$("#register_form div:first-child").removeClass("hidden");$("#register_form div:first-child span").text("Passwords did not match!");return false}var t=$("#register_form").serialize();dataSent=true;$("#register_form div:first-child").addClass("hidden");$.ajax({type:"POST",url:relPath+"a/",data:t,success:function(e){try{e=jQuery.parseJSON(e);if(e.sucess==="false"){if(typeof e.field!=="undefined"){$("#"+e.field).addClass("error")}if(typeof e.error!=="undefined"){$("#register_form div:first-child").removeClass("hidden");$("#register_form div:first-child span").text(e.error)}dataSent=false}else{$("#register_form div:first-child").removeClass("hidden").removeClass("error").addClass("success");$("#register_form div:first-child span").text("Your account has been sucesfully created. You will be redirected to the main page in 5 seconds.");var t=5;setInterval(function(){t--;$("#register_form div:first-child span").text("Your account has been sucesfully created. You will be redirected to the main page in "+t+" seconds.");if(t<=0){window.location=relPath}},1e3)}}catch(n){$("#register_form div:first-child").removeClass("hidden");$("#register_form div:first-child span").text("An error has occured, please contact us!");return false}}});return false}function handleTextFormSubmit(e){e.preventDefault();e.stopPropagation();if(dataSent){return false}if(editor.getSession().getValue()<=0){return false}var t=$("#text_form").serializeArray();t.push({name:"data",value:editor.getSession().getValue().replaceAll("\n","</br>")});t=$.param(t);dataSent=true;$("#editor_settings, .editor_home_container").hide();var n=$(window).height();$(".container").css("height",n+"px");$("#text_upload_load").fadeIn();$.ajax({xhr:function(){var e=new window.XMLHttpRequest;e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;$("#upload_percent").text(t);$("#progressbar div:last-child").css("width",t+"%")}},false);return e},type:"POST",url:relPath+"p/",data:t,success:function(e){try{console.log(e);e=jQuery.parseJSON(e);if(e.sucess){window.location=relPath+"p/"+e.id}else{if(e.error!==false){$("#text_upload_error span").text(e.error)}$("#text_upload_error").fadeIn();$("#text_upload_load").hide()}}catch(t){console.log(t);$("#text_upload_error").fadeIn();$("#text_upload_load").hide()}},fail:function(e){console.log(e);$("#text_upload_error").fadeIn();$("#text_upload_load").hide()}});return false}function refreshBlock(e,t,n){$.ajax({type:"POST",data:{type:"content_block",content_block:e},url:relPath+"lunor/",success:function(e){try{$(t).replaceWith(e);n()}catch(r){}}})}function validEmail(e){var t=e.indexOf("@");var n=e.lastIndexOf(".");if(t<1||n<t+2||n+2>=e.length){return false}return true}function handleResize(){var e=$(window).height();var t=$("footer").height()+$("header").height()+20;if(getTabInUse()==="text"){var n=$("#editor_settings").height()+65;$(".editor_home_container").css("height","calc(100% - "+n+"px)")}else if(getTabInUse()=="file"){var n=$("#file_editor_settings").height()+65;$("#drop_zone_container").css("height","calc(100% - "+n+"px)")}if(!$("#original_image, .block-content-container").exists()){$(".content").css("height","calc(100% - "+t+"px)");$(".container").css("height",e+"px")}if(typeof editor!=="undefined")editor.resize(true)}function switchToTextEditor(e){tabSelected=true;$(".file_tab").hide();$("#editor_settings").removeClass("hidden");$(".editor_home_container").addClass("editor_home_editing");$(".text_tab").removeClass("col_6");$(".text_tab").addClass("col_12");$(".upload_slide .top-padding").hide();handleTightWidth();handleResize();editor.focus();editor.getSession().setMode("ace/mode/text");editor.setValue(e);editor.setReadOnly(false);editor.resize(true);editor.gotoLine(99999,0,true)}function switchToFileUpload(){tabSelected=true;$(".text_tab").hide();$(".file_tab").removeClass("col_6");$(".file_tab").addClass("col_12");$("#file_editor_settings").removeClass("hidden");handleTightWidth();handleResize();lightsOn()}function expirationChange(e){var t="#expiration";if(getTabInUse()==="file")t="#file_expiration";var n=$(t+" option:selected").val();var r=$(t).parent().parent();if(n=="views"){r.find("input").parent().css("display","visible");$("#expiration_chosen").parent().addClass("col_6")}else if($("#expiration_chosen.col_6")){$("#expiration_chosen").parent().removeClass("col_6");r.find("input").parent().css("display","none")}}function modeChange(e){if(getTabInUse()==="text"){var t=$("#mode option:selected").val();editor.getSession().setMode("ace/mode/"+t)}}function handleKeyDown(e){if(e.which>=32&&e.which<=126&&!e.ctrlKey){var t=String.fromCharCode(e.which);if(typeof editor!=="undefined"&&getTabInUse()==="both"){if(editor.getReadOnly()&&editor.isFocused()){switchToTextEditor(t);return false}}}return true}function lightsOn(){$(".lights_off").css("display","none");$("#editor").css("z-index","1");$(".dropzone").css("z-index","1")}function lightsOff(e){if(typeof e==="undefined"||e===true){$("#editor").css("z-index","10000");$(".dropzone").css("z-index","10000")}$(".lights_off").css("display","block")}function isLightOn(){return $(".lights_off").css("display")=="none"}function imagePaste(e,t){$(".upload_slide").prepend('<img src="'+t+'" />')}function textPaste(e,t){if(typeof editor!=="undefined"&&getTabInUse()=="both"){switchToTextEditor(t)}}function getTabInUse(){var e=$(".text_tab").length>0?$(".text_tab").css("display")!=="none":false;var t=$(".file_tab").length>0?$(".file_tab").css("display")!=="none":false;if(e&&t){return"both"}else if(e){return"text"}else if(t){return"file"}return"none"}function pasteInterpreter(e){var t=e.originalEvent.clipboardData||e.clipboardData||window.clipboardData;var n=t.items;if(n){for(var r=0;r<n.length;r++){if(n[r].type.indexOf("image")!==-1){var i=n[r].getAsFile();var s=window.URL||window.webkitURL;var o=s.createObjectURL(i);e.preventDefault();$(document).trigger("imagePaste",o);return}}}var u=t.getData("Text");$(document).trigger("textPaste",u);return true}jQuery.prototype.exists=function(){return this.length>0};var relPath="/";$(document).ready(load());var timeout=-1,det=-1,showDrag=false;var dataSent=false;var hadEditor=false;if(typeof window["Dropzone"]!=="undefined"){Dropzone.options.fileDropZone={paramName:"tmp.file",parallelUploads:1,maxFilesize:16,maxFiles:1,maxThumbnailFilesize:16,thumbnailWidth:300,addRemoveLinks:true,autoProcessQueue:false,thumbnailHeight:300,url:relPath+"p/",accept:function(e,t){switchToFileUpload();t()},success:function(e,t){try{t=jQuery.parseJSON(t);if(t.sucess){window.location=relPath+"p/"+t.id}else{if(t.error!==false){$("#text_upload_error span").text(t.error)}$("#text_upload_error").fadeIn();$("#text_upload_load").hide()}}catch(n){$("#text_upload_error").fadeIn();$("#text_upload_load").hide()}}}}String.prototype.replaceAll=function(e,t,n){var r;var i=this+"";var s=-1;if(typeof e==="string"){if(n){r=e.toLowerCase();while((s=i.toLowerCase().indexOf(e,s>=0?s+t.length:0))!==-1){i=i.substring(0,s)+t+i.substring(s+e.length)}}else{return this.split(e).join(t)}}return i}